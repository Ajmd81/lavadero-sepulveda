<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.lavaderosepulveda.crm.controller.FacturacionController"
            styleClass="main-container">

    <top>
        <VBox spacing="10">
            <padding><Insets top="15" right="20" bottom="10" left="20"/></padding>

            <!-- TÃ­tulo -->
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Label text="FacturaciÃ³n"
                       graphicTextGap="20"
                       styleClass="title-label">
                    <graphic>
                        <ImageView fitHeight="64" fitWidth="64" preserveRatio="true">
                            <image>
                                <Image url="@/images/facturacion.png"/>
                            </image>
                        </ImageView>
                    </graphic>
                </Label>
                <Region HBox.hgrow="ALWAYS"/>
                <Button fx:id="btnResumenFinanciero"
                        text="Resumen Financiero"
                        styleClass="btn-secundario"
                        onAction="#mostrarResumenFinanciero">

                    <graphic>
                        <ImageView fitHeight="18" fitWidth="18" preserveRatio="true">
                            <image>
                                <Image url="@/images/estado-financiero.png"/>
                            </image>
                        </ImageView>
                    </graphic>
                </Button>

            </HBox>
        </VBox>
    </top>

    <center>
        <TabPane fx:id="tabPane" tabClosingPolicy="UNAVAILABLE">

            <!-- TAB: Facturas Emitidas -->
            <Tab fx:id="tabEmitidas" text="Facturas Emitidas">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16" preserveRatio="true">
                        <image>
                            <Image url="@/images/facturaEmitida.png"/>
                        </image>
                    </ImageView>
                </graphic>

                <VBox spacing="10">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>

                    <!-- Barra de herramientas -->
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <TextField fx:id="txtBuscarEmitida" promptText="Buscar por nÃºmero, cliente..." prefWidth="250"/>
                        <Button text="ðŸ”" onAction="#buscarFacturaEmitida" styleClass="btn-icono"/>
                        <ComboBox fx:id="cmbEstadoEmitida" promptText="Estado" prefWidth="120"/>
                        <DatePicker fx:id="dpDesdeEmitida" promptText="Desde" prefWidth="130"/>
                        <DatePicker fx:id="dpHastaEmitida" promptText="Hasta" prefWidth="130"/>
                        <Button text="Filtrar" onAction="#filtrarFacturasEmitidas" styleClass="btn-secundario"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button fx:id="btnNuevaEmitida" text="âž• Nueva Factura" onAction="#nuevaFacturaEmitida" styleClass="btn-primario"/>
                    </HBox>

                    <!-- Tabla -->
                    <TableView fx:id="tablaEmitidas" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colNumeroEmitida" text="NÃºmero" prefWidth="100"/>
                            <TableColumn fx:id="colFechaEmitida" text="Fecha" prefWidth="100"/>
                            <TableColumn fx:id="colClienteEmitida" text="Cliente" prefWidth="200"/>
                            <TableColumn fx:id="colConceptoEmitida" text="Concepto" prefWidth="400"/>
                            <TableColumn fx:id="colBaseEmitida" text="Base" prefWidth="90"/>
                            <TableColumn fx:id="colIvaEmitida" text="IVA" prefWidth="80"/>
                            <TableColumn fx:id="colTotalEmitida" text="Total" prefWidth="100"/>
                            <TableColumn fx:id="colEstadoEmitida" text="Estado" prefWidth="100"/>
                            <TableColumn fx:id="colAccionesEmitida" text="Acciones" prefWidth="200"/>
                        </columns>
                        <placeholder><Label text="No hay facturas emitidas"/></placeholder>
                    </TableView>

                    <!-- Totales -->
                    <HBox spacing="30" alignment="CENTER_RIGHT" styleClass="barra-totales">
                        <Label fx:id="lblTotalBaseEmitidas" text="Base: 0,00 â‚¬"/>
                        <Label fx:id="lblTotalIvaEmitidas" text="IVA: 0,00 â‚¬"/>
                        <Label fx:id="lblTotalEmitidas" text="Total: 0,00 â‚¬" styleClass="total-destacado"/>
                    </HBox>
                </VBox>
            </Tab>

            <!-- TAB: Facturas Recibidas -->
            <Tab fx:id="tabRecibidas" text="Facturas Recibidas">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16" preserveRatio="true">
                        <image>
                            <Image url="@/images/invoice.png"/>
                        </image>
                    </ImageView>
                </graphic>

                <VBox spacing="10">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>

                    <!-- Barra de herramientas -->
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <TextField fx:id="txtBuscarRecibida" promptText="Buscar por nÃºmero, proveedor..." prefWidth="250"/>
                        <Button text="ðŸ”" onAction="#buscarFacturaRecibida" styleClass="btn-icono"/>
                        <ComboBox fx:id="cmbCategoriaRecibida" promptText="CategorÃ­a" prefWidth="150"/>
                        <ComboBox fx:id="cmbEstadoRecibida" promptText="Estado" prefWidth="120"/>
                        <DatePicker fx:id="dpDesdeRecibida" promptText="Desde" prefWidth="130"/>
                        <DatePicker fx:id="dpHastaRecibida" promptText="Hasta" prefWidth="130"/>
                        <Button text="Filtrar" onAction="#filtrarFacturasRecibidas" styleClass="btn-secundario"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ¤µ Proveedores" onAction="#gestionarProveedores" styleClass="btn-secundario"/>
                        <Button fx:id="btnNuevaRecibida" text="âž• Nueva Factura" onAction="#nuevaFacturaRecibida" styleClass="btn-primario"/>
                    </HBox>

                    <!-- Tabla -->
                    <TableView fx:id="tablaRecibidas" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colNumeroRecibida" text="NÂº Factura" prefWidth="120"/>
                            <TableColumn fx:id="colFechaRecibida" text="Fecha" prefWidth="100"/>
                            <TableColumn fx:id="colProveedorRecibida" text="Proveedor" prefWidth="180"/>
                            <TableColumn fx:id="colCategoriaRecibida" text="CategorÃ­a" prefWidth="130"/>
                            <TableColumn fx:id="colConceptoRecibida" text="Concepto" prefWidth="180"/>
                            <TableColumn fx:id="colBaseRecibida" text="Base" prefWidth="90"/>
                            <TableColumn fx:id="colIvaRecibida" text="IVA" prefWidth="80"/>
                            <TableColumn fx:id="colTotalRecibida" text="Total" prefWidth="100"/>
                            <TableColumn fx:id="colEstadoRecibida" text="Estado" prefWidth="100"/>
                            <TableColumn fx:id="colVencimientoRecibida" text="Vencimiento" prefWidth="100"/>
                            <TableColumn fx:id="colAccionesRecibida" text="Acciones" prefWidth="200"/>
                        </columns>
                        <placeholder><Label text="No hay facturas recibidas"/></placeholder>
                    </TableView>

                    <!-- Totales -->
                    <HBox spacing="30" alignment="CENTER_RIGHT" styleClass="barra-totales">
                        <Label fx:id="lblPendientesRecibidas" text="Pendientes: 0" styleClass="alerta-pendiente"/>
                        <Label fx:id="lblTotalBaseRecibidas" text="Base: 0,00 â‚¬"/>
                        <Label fx:id="lblTotalIvaRecibidas" text="IVA Soportado: 0,00 â‚¬"/>
                        <Label fx:id="lblTotalRecibidas" text="Total: 0,00 â‚¬" styleClass="total-destacado"/>
                    </HBox>
                </VBox>
            </Tab>

            <!-- TAB: Gastos -->
            <Tab fx:id="tabGastos"
                 text="Gastos">
                <graphic>
                    <ImageView fitHeight="16" fitWidth="16" preserveRatio="true">
                        <image>
                            <Image url="@/images/carro-de-la-compra.png"/>
                        </image>
                    </ImageView>
                </graphic>

                <VBox spacing="10">
                    <padding>
                        <Insets top="15" right="15" bottom="15" left="15"/>
                    </padding>

                    <!-- Barra de herramientas -->
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <TextField fx:id="txtBuscarGasto" promptText="Buscar por concepto..." prefWidth="250"/>
                        <Button text="ðŸ”" onAction="#buscarGasto" styleClass="btn-icono"/>
                        <ComboBox fx:id="cmbCategoriaGasto" promptText="CategorÃ­a" prefWidth="150"/>
                        <DatePicker fx:id="dpDesdeGasto" promptText="Desde" prefWidth="130"/>
                        <DatePicker fx:id="dpHastaGasto" promptText="Hasta" prefWidth="130"/>
                        <Button text="Filtrar" onAction="#filtrarGastos" styleClass="btn-secundario"/>
                        <CheckBox fx:id="chkSoloRecurrentes" text="Solo recurrentes"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button fx:id="btnNuevoGasto" text="âž• Nuevo Gasto" onAction="#nuevoGasto" styleClass="btn-primario"/>
                    </HBox>

                    <!-- Tabla -->
                    <TableView fx:id="tablaGastos" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colFechaGasto" text="Fecha" prefWidth="100"/>
                            <TableColumn fx:id="colConceptoGasto" text="Concepto" prefWidth="250"/>
                            <TableColumn fx:id="colCategoriaGasto" text="CategorÃ­a" prefWidth="150"/>
                            <TableColumn fx:id="colImporteGasto" text="Importe" prefWidth="100"/>
                            <TableColumn fx:id="colBaseGasto" text="Base" prefWidth="90"/>
                            <TableColumn fx:id="colIvaGasto" text="IVA" prefWidth="80"/>
                            <TableColumn fx:id="colMetodoPagoGasto" text="MÃ©todo Pago" prefWidth="100"/>
                            <TableColumn fx:id="colRecurrenteGasto" text="Recurrente" prefWidth="80"/>
                            <TableColumn fx:id="colPagadoGasto" text="Pagado" prefWidth="80"/>
                            <TableColumn fx:id="colAccionesGasto" text="Acciones" prefWidth="150"/>
                        </columns>
                        <placeholder><Label text="No hay gastos registrados"/></placeholder>
                    </TableView>

                    <!-- Totales -->
                    <HBox spacing="30" alignment="CENTER_RIGHT" styleClass="barra-totales">
                        <Label fx:id="lblNumGastos" text="Gastos: 0"/>
                        <Label fx:id="lblTotalBaseGastos" text="Base: 0,00 â‚¬"/>
                        <Label fx:id="lblTotalIvaGastos" text="IVA Soportado: 0,00 â‚¬"/>
                        <Label fx:id="lblTotalGastos" text="Total: 0,00 â‚¬" styleClass="total-destacado"/>
                    </HBox>
                </VBox>
            </Tab>

        </TabPane>
    </center>

</BorderPane>
